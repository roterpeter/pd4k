<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Classroom</title>
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <style>
    /* Base Styles */
    html,body{background-color:#141414;margin:0;padding:0;font-family:'Poppins',Helvetica,Arial,sans-serif;color:white;overflow-x:hidden;width:100%;}
    a{text-decoration:none;color:#e5e5e5;opacity:.83;transition:0.3s ease-in-out}
    a:hover{opacity:1;color:white;transform:scale(1.05)}
    
    /* Header & Navigation */
    header{position:fixed;top:0;left:0;width:100%;z-index:100;background:rgba(20,20,20,0.7);backdrop-filter:blur(6px);padding:15px 0;animation:fadeInDown .6s ease-in-out;}
    .header-cont{display:flex;justify-content:space-between;align-items:center;width:90%;margin:auto;flex-wrap:wrap;transition:all .3s ease-in-out;}
    .main-nav{list-style:none;display:flex;gap:20px;margin:0;padding:0;}
    .header-brand{max-width:140px;transition:transform .3s ease-in-out;}
    .header-brand:hover{transform:scale(1.1)}
    
    /* Search Bar */
    .search-bar{margin-top:10px;flex:1 1 100%;display:flex;justify-content:center;align-items:center;gap:10px;animation:fadeIn .7s ease-in-out;}
    .search-bar input{width:80%;max-width:500px;padding:12px 18px;border-radius:30px;border:1px solid rgba(255,255,255,0.2);background:rgba(255,255,255,0.1);color:white;font-size:16px;backdrop-filter:blur(4px);transition:all .3s ease-in-out;}
    .search-bar input:focus{border-color:#e50914;background:rgba(255,255,255,0.2);}
    .search-bar button{padding:12px 24px;border:none;border-radius:30px;background:#e50914;color:#fff;font-weight:700;cursor:pointer;transition:all .3s ease-in-out;}
    .search-bar button:hover{background:#f40612;transform:scale(1.05)}

    /* Spacer element */
    #header-spacer {
        width: 100%;
        height: 0;
    }

    /* Categories Section */
    .categories-section {
        width: 90%;
        margin: 20px auto; 
        padding: 20px 0;
        animation: fadeIn 0.8s ease-in-out;
    }
    .categories-section h3 {
        font-size: 1.5rem;
        margin-bottom: 15px;
        border-bottom: 2px solid #e50914;
        display: inline-block;
        padding-bottom: 5px;
    }
    .category-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }
    .category-buttons button {
        background: rgba(255, 255, 255, 0.1);
        color: white;
        border: 1px solid #555;
        padding: 10px 20px;
        border-radius: 20px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease-in-out;
    }
    .category-buttons button:hover, .category-buttons button.active {
        background: #e50914;
        border-color: #e50914;
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(229, 9, 20, 0.4);
    }

    /* Search/Results Grid */
    .search-results{padding:20px;display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:15px;justify-items:center;width:100%;max-width: 90%; margin: auto; animation:fadeIn .6s ease-in-out;}
    .movie-item {
        position: relative;
        text-align: center;
        width: 100%;
        max-width: 160px;
    }
    .search-results img{width:100%;max-width:160px;border-radius:8px;cursor:pointer;transition:transform .3s ease-in-out, box-shadow .3s ease-in-out;}
    .search-results img:hover{transform:scale(1.08);box-shadow:0 0 20px rgba(0,0,0,0.6)}
    .movie-title {
        font-size: 0.9em;
        margin-top: 5px;
        opacity: 0.8;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    /* Info Overlay */
    #info-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);backdrop-filter:blur(10px);z-index:999;justify-content:center;align-items:center;animation:fadeIn .6s ease-in-out;overflow-y:auto;padding:20px 0;}
    .info-popup{background-color:#181818;border-radius:10px;max-width:1000px;width:90%;overflow:hidden;box-shadow:0 0 40px rgba(0,0,0,0.8);animation:fadeInUp 0.3s ease;margin:auto;}
    .info-header{display:flex;justify-content:space-between;align-items:center;padding:15px 20px;border-bottom:1px solid #333;}
    .info-header h2{margin:0;font-size:22px;}
    .info-close{background:none;border:none;color:white;font-size:26px;cursor:pointer;transition:transform .3s ease-in-out;}
    .info-close:hover{transform:rotate(90deg);}
    .info-body{padding:20px;}
    .info-content{display:flex;gap:20px;margin-bottom:20px;flex-wrap:wrap;}
    .info-poster{flex-shrink:0;}
    .info-poster img{width:200px;border-radius:8px;box-shadow:0 4px 15px rgba(0,0,0,0.5);}
    .info-details{flex:1;min-width:250px;}
    .info-meta{display:flex;gap:15px;margin:10px 0;flex-wrap:wrap;font-size:14px;opacity:0.9;}
    .info-rating{color:#46d369;font-weight:700;}
    .info-overview{line-height:1.6;margin-top:15px;opacity:0.95;}
    .player-container{position:relative;padding-bottom:56.25%;height:0;overflow:hidden;border-radius:8px;margin-top:20px;}
    .player-container iframe{position:absolute;top:0;left:0;width:100%;height:100%;border:0;}
    .selectors{margin-top:20px;display:flex;gap:15px;align-items:center;flex-wrap:wrap;}
    .selectors label, .selectors select { font-size: 16px; }
    .selectors select {
        padding: 8px 12px;
        border-radius: 5px;
        border: 1px solid #555;
        background-color: #333;
        color: white;
        cursor: pointer;
        outline: none;
        transition: border-color 0.3s;
    }
    .selectors select:focus {
        border-color: #e50914;
    }

    /* Animations */
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    @keyframes fadeInUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
    @keyframes fadeInDown{from{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
  <header>
    <div class="header-cont">
        <a href="/">
  <img class="header-brand" src="logo.png" alt="logo" />
</a>

      <ul class="main-nav">
        <li><a href="javascript:void(0)" onclick="loadInitialContent('movie')">Movies</a></li>
        <li><a href="javascript:void(0)" onclick="loadInitialContent('tv')">TV Shows</a></li>
      </ul>
      <div class="search-bar">
        <input id="searchInput" type="text" placeholder="Search for movies or shows..." />
        <button onclick="searchContent()">Search</button>
      </div>
    </div>
  </header>

  <div id="header-spacer"></div>

  <!-- Categories Section -->
  <div class="categories-section" id="categoriesSection">
    <h3>Browse by Genre</h3>
    <div class="category-buttons" id="categoryButtons">
      <!-- Buttons will be generated here by JavaScript -->
    </div>
  </div>

  <!-- Search/Category Results -->
  <div class="search-results" id="searchResults"></div>

  <!-- Info Overlay/Popup -->
  <div id="info-overlay">
    <div class="info-popup">
      <div class="info-header">
        <h2 id="info-title">Loading...</h2>
        <button class="info-close" onclick="closeInfo()">&times;</button>
      </div>
      <div class="info-body">
        <div class="info-content">
          <div class="info-poster">
            <img id="info-poster-img" src="" alt="Poster" onerror="this.style.display='none'" />
          </div>
          <div class="info-details">
            <div class="info-meta">
              <span class="info-rating" id="info-rating">★ -</span>
              <span id="info-release">-</span>
              <span id="info-runtime">-</span>
            </div>
            <div class="info-overview" id="info-overview">Loading...</div>
          </div>
        </div>
        <div class="player-container">
          <iframe id="info-player" src="" allowfullscreen allow="encrypted-media"></iframe>
        </div>
        <div id="selectors" class="selectors" style="display:none;">
          <label for="seasonSelect">Season:</label>
          <select id="seasonSelect"></select>
          <label for="episodeSelect">Episode:</label>
          <select id="episodeSelect"></select>
        </div>
      </div>
    </div>
  </div>

  <script>
    const apikey = "e950e51d5d49e85f7c2f17f01eb23ba3";
    const apiEndpoint = "https://api.themoviedb.org/3";
    const imgPath = "https://image.tmdb.org/t/p/w500";
    
    // --- GENRE DATA ---
    const GENRES = [
        { id: 28, name: "Action" },
        { id: 16, name: "Animation" },
        { id: 35, name: "Comedy" },
        { id: 80, name: "Crime" },
        { id: 99, name: "Documentary" },
        { id: 18, name: "Drama" },
        { id: 10751, name: "Family" },
        { id: 14, name: "Fantasy" },
        { id: 27, name: "Horror" },
        { id: 10749, name: "Romance" },
        { id: 878, name: "Sci-Fi" },
    ];
    
    let currentContentType = 'movie';

    function adjustContentPadding() {
        const header = document.querySelector('header');
        const spacer = document.getElementById('header-spacer');
        if (header && spacer) {
            const headerHeight = header.offsetHeight;
            spacer.style.height = `${headerHeight}px`;
        }
    }

    function renderResults(results, title = 'Popular Content') {
        const container = document.getElementById('searchResults');
        
        const existingTitle = document.getElementById('resultsTitle');
        if (existingTitle) {
            existingTitle.remove();
        }
        
        container.innerHTML = '';
        
        if (document.getElementById('searchInput').value.trim() === '') {
            container.insertAdjacentHTML('beforebegin', `<h3 id="resultsTitle" style="text-align: center; width: 90%; margin: 20px auto 10px; font-size: 1.5em; border-bottom: 2px solid #e50914; padding-bottom: 5px;">${title}</h3>`);
        } else {
            document.getElementById('resultsTitle')?.remove();
        }

        if (results.length === 0) {
            container.innerHTML = `<div style="text-align: center; padding: 50px; font-size: 1.2em;">No results found.</div>`;
            return;
        }

        container.innerHTML = results.map(m => {
            const mediaType = m.media_type || (m.first_air_date ? 'tv' : 'movie');
            const itemTitle = m.title || m.name;
            return `
                <div class='movie-item' onclick="openInfo(${m.id}, '${mediaType}')">
                  <img src='${imgPath + m.poster_path}' alt='${itemTitle}' onerror="this.onerror=null;this.src='https://placehold.co/160x240/1f1f1f/ffffff?text=No+Poster'" />
                  <div class='movie-title'>${itemTitle}</div>
                </div>`;
        }).join('');
    }
    
    async function loadContent(type = 'movie', genreId = null, genreName = '') {
        currentContentType = type;
        const resultsContainer = document.getElementById('searchResults');
        resultsContainer.innerHTML = `<div style="text-align: center; padding: 50px; font-size: 1.5em;">Loading ${genreName ? genreName : type} content...</div>`;

        let title = `Popular ${type === 'movie' ? 'Movies' : 'TV Shows'}`;

        if (genreId) {
            title = `${genreName} ${type === 'movie' ? 'Movies' : 'TV Shows'}`;
        }

        try {
            const pages = [1, 2, 3];
            const promises = pages.map(page => {
                let url = `${apiEndpoint}/discover/${type}?api_key=${apikey}&language=en-US&sort_by=popularity.desc&include_adult=false&include_video=false&page=${page}`;
                if (genreId) {
                    url += `&with_genres=${genreId}`;
                }
                return fetch(url).then(res => res.json());
            });

            const results = await Promise.all(promises);
            const allResults = results.flatMap(data => data.results).slice(0, 60);
            
            renderResults(allResults, title);
        } catch (error) {
            console.error("Error loading content:", error);
            resultsContainer.innerHTML = `<div style="text-align: center; padding: 50px; font-size: 1.2em; color: #f40612;">Error loading content. Please try again.</div>`;
        }
    }
    
    function setupCategories() {
        const categoriesContainer = document.getElementById('categoryButtons');
        categoriesContainer.innerHTML = '';

        GENRES.forEach(genre => {
            const button = document.createElement('button');
            button.textContent = genre.name;
            button.setAttribute('data-genre-id', genre.id);
            button.setAttribute('data-genre-name', genre.name);
            
            button.onclick = (event) => {
                document.querySelectorAll('.category-buttons button').forEach(btn => {
                    btn.classList.remove('active');
                });
                event.target.classList.add('active');
                
                loadContent(currentContentType, genre.id, genre.name);
            };
            categoriesContainer.appendChild(button);
        });
    }

    function loadInitialContent(type = 'movie') {
        document.getElementById('categoriesSection').style.display = 'block';
        document.getElementById('searchInput').value = '';
        document.querySelectorAll('.category-buttons button').forEach(btn => btn.classList.remove('active'));
        
        loadContent(type);
    }
    
    async function searchContent() {
      const query = document.getElementById('searchInput').value.trim();
      
      if (!query) {
        document.getElementById('categoriesSection').style.display = 'block';
        loadInitialContent(currentContentType);
        return;
      }
      
      document.getElementById('categoriesSection').style.display = 'none';
      
      const resultsContainer = document.getElementById('searchResults');
      resultsContainer.innerHTML = `<div style="text-align: center; padding: 50px; font-size: 1.5em;">Searching for "${query}"...</div>`;

      try {
        const [movieRes, tvRes] = await Promise.all([
          fetch(`${apiEndpoint}/search/movie?api_key=${apikey}&query=${encodeURIComponent(query)}`),
          fetch(`${apiEndpoint}/search/tv?api_key=${apikey}&query=${encodeURIComponent(query)}`)
        ]);

        const movieData = await movieRes.json();
        const tvData = await tvRes.json();

        const allResults = [...movieData.results, ...tvData.results]
            .filter(m => m.poster_path)
            .sort((a, b) => (b.popularity || 0) - (a.popularity || 0)); 
        
        if (allResults.length === 0) {
            resultsContainer.innerHTML = `<div style="text-align: center; padding: 50px; font-size: 1.2em;">No results found for "${query}".</div>`;
            return;
        }

        renderResults(allResults, `Search Results for "${query}"`);
      } catch (error) {
        console.error("Error during content search:", error);
        resultsContainer.innerHTML = `<div style="text-align: center; padding: 50px; font-size: 1.2em; color: #f40612;">An error occurred while fetching data.</div>`;
      }
    }

    async function openInfo(id, type) {
      const overlay = document.getElementById('info-overlay');
      const titleEl = document.getElementById('info-title');
      const player = document.getElementById('info-player');
      const selectors = document.getElementById('selectors');
      const seasonSelect = document.getElementById('seasonSelect');
      const episodeSelect = document.getElementById('episodeSelect');
      const posterImg = document.getElementById('info-poster-img');
      const ratingEl = document.getElementById('info-rating');
      const releaseEl = document.getElementById('info-release');
      const runtimeEl = document.getElementById('info-runtime');
      const overviewEl = document.getElementById('info-overview');

      overlay.style.display = 'flex';
      selectors.style.display = 'none';
      titleEl.textContent = 'Loading...';
      player.src = 'about:blank';
      posterImg.src = '';
      ratingEl.textContent = '★ -';
      releaseEl.textContent = '-';
      runtimeEl.textContent = '-';
      overviewEl.textContent = 'Loading...';

      try {
        const res = await fetch(`${apiEndpoint}/${type}/${id}?api_key=${apikey}&language=en-US`);
        const info = await res.json();

        titleEl.textContent = info.title || info.name;
        
        if (info.poster_path) {
          posterImg.src = imgPath + info.poster_path;
          posterImg.style.display = 'block';
        } else {
          posterImg.style.display = 'none';
        }
        
        if (info.vote_average) {
          ratingEl.textContent = `★ ${info.vote_average.toFixed(1)}/10`;
        }
        
        const releaseDate = info.release_date || info.first_air_date;
        if (releaseDate) {
          const year = new Date(releaseDate).getFullYear();
          releaseEl.textContent = year;
        }
        
        if (type === 'movie' && info.runtime) {
          const hours = Math.floor(info.runtime / 60);
          const mins = info.runtime % 60;
          runtimeEl.textContent = hours > 0 ? `${hours}h ${mins}m` : `${mins}m`;
        } else if (type === 'tv' && info.episode_run_time && info.episode_run_time.length > 0) {
          runtimeEl.textContent = `${info.episode_run_time[0]}m per episode`;
        }
        
        overviewEl.textContent = info.overview || 'No description available.';

        if (type === 'movie') {
          player.src = `https://player.videasy.net/movie/${id}?overlay=true&color=E50914`;
        } else if (type === 'tv') {
          selectors.style.display = 'flex';
          seasonSelect.innerHTML = '';
          episodeSelect.innerHTML = '';

          const viewableSeasons = info.seasons.filter(s => s.season_number > 0);
          
          if (viewableSeasons.length === 0) {
             titleEl.textContent += " (No viewable season data)";
             selectors.style.display = 'none';
             player.src = 'about:blank';
             return;
          }
          
          const initialSeason = viewableSeasons[0].season_number;
          let currentShowId = id; 

          viewableSeasons.forEach(s => {
            const opt = document.createElement('option');
            opt.value = s.season_number;
            opt.textContent = s.name && s.name !== `Season ${s.season_number}` ? `${s.name} (S${s.season_number})` : `Season ${s.season_number}`;
            seasonSelect.appendChild(opt);
          });
          
          seasonSelect.value = initialSeason;

          async function loadEpisodes(season) {
            episodeSelect.innerHTML = '<option>Loading episodes...</option>';
            player.src = 'about:blank';
            
            const epRes = await fetch(`${apiEndpoint}/tv/${currentShowId}/season/${season}?api_key=${apikey}`);
            const epData = await epRes.json();
            
            episodeSelect.innerHTML = '';

            if (epData.episodes && epData.episodes.length > 0) {
              epData.episodes.forEach(ep => {
                const opt = document.createElement('option');
                opt.value = ep.episode_number;
                opt.textContent = `E${ep.episode_number}: ${ep.name || 'Untitled Episode'}`;
                episodeSelect.appendChild(opt);
              });
              
              const firstEpisodeNumber = epData.episodes[0].episode_number;
              episodeSelect.value = firstEpisodeNumber; 
              player.src = `https://player.videasy.net/tv/${currentShowId}/${season}/${firstEpisodeNumber}?overlay=true&episodeSelector=true&autoplayNextEpisode=true&color=E50914`;
            } else {
              episodeSelect.innerHTML = '<option value="">No Episodes Found</option>';
            }
          }

          await loadEpisodes(initialSeason);

          seasonSelect.onchange = async () => {
            await loadEpisodes(seasonSelect.value);
          };

          episodeSelect.onchange = () => {
            const season = seasonSelect.value;
            const episode = episodeSelect.value;
            if (season && episode) {
                player.src = `https://player.videasy.net/tv/${currentShowId}/${season}/${episode}?overlay=true&episodeSelector=true&autoplayNextEpisode=true&color=E50914`;
            } else {
                player.src = 'about:blank';
            }
          };
        }
      } catch (error) {
        console.error("Error loading info:", error);
        titleEl.textContent = "Error Loading Content";
        overviewEl.textContent = "Unable to load content details.";
        selectors.style.display = 'none';
      }
    }

    function closeInfo() {
      const overlay = document.getElementById('info-overlay');
      const player = document.getElementById('info-player');
      overlay.style.display = 'none';
      player.src = '';
    }
    
    window.onload = function() {
        adjustContentPadding(); 
        window.addEventListener('resize', adjustContentPadding);
        
        setupCategories();
        loadInitialContent();
    }
  </script>
</body>
</html>